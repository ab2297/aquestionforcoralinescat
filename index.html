<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Valentine?</title>

<!-- Cute fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Fredoka:wght@400;600&display=swap" rel="stylesheet">

<style>
:root{
  --card: rgba(255,255,255,.72);
  --border: rgba(255,255,255,.55);
  --shadow: 0 18px 60px rgba(0,0,0,.28);
}

*{ box-sizing:border-box; }

body{
  margin:0;
  min-height:100svh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:
    linear-gradient(rgba(0,0,0,.3),rgba(0,0,0,.3)),
    url("background.jpg") center/cover no-repeat fixed;
  padding: 14px; /* helps on phones */
}

/* floating emojis */
.flowers{
  position:fixed;
  inset:0;
  pointer-events:none;
  display:none;
  z-index:999;
}
.flowers.show{display:block;}
.flower{
  position:absolute;
  bottom:-40px;
  font-size:28px;
  animation:floatUp linear forwards;
}
@keyframes floatUp{
  to{transform:translateY(-110vh) rotate(360deg);opacity:0;}
}

.wrap{width:min(620px,94vw);padding:22px;}

.card{
  background:rgba(255,255,255,.72);
  border-radius:26px;
  padding:26px;
  box-shadow:var(--shadow);
  backdrop-filter:blur(10px);
  text-align:center;
  position: relative;
}

/* üíñ Cute question font */
.title{
  font-family: "Pacifico", cursive;
  font-size: clamp(36px,6vw,56px);
  margin-bottom:14px;
  transition: opacity .4s ease, transform .4s ease;
  line-height: 1.15;
}
.title.hide{
  opacity:0;
  transform:translateY(-10px);
  pointer-events:none;
}

.arena{
  position:relative;
  margin:20px auto;
  width:min(560px,92vw);
  height:170px;
  border-radius:22px;
  background:rgba(255,255,255,.28);
  border: 1px solid rgba(255,255,255,.45);
  overflow:hidden; /* ‚úÖ keep everything inside */
}

/* YES & NO image buttons (previous format) */
.yesImgBtn,.noImgBtn{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  width:175px;         /* base size (desktop) */
  height:auto;
  cursor:pointer;
  user-select:none;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  filter:drop-shadow(0 14px 18px rgba(0,0,0,.28));
  transition:transform .12s ease, filter .12s ease;
}
.yesImgBtn:hover,.noImgBtn:hover{
  transform:translateY(-50%) scale(1.05);
  filter: brightness(1.05) drop-shadow(0 16px 22px rgba(0,0,0,.28));
}
.yesImgBtn:active,.noImgBtn:active{
  transform:translateY(-50%) scale(.95);
}

/* Keep your old anchor positions */
.yesImgBtn{ left:16px; }
.noImgBtn{ left:50%; }

/* Dog */
.dogChaser{
  position:absolute;
  width:96px;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  pointer-events:none;
}
.dogChaser.front{z-index:7;}
.dogChaser img{width:100%;}

/* Celebration */
.celebration{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  width:calc(100% - 32px);
  max-width:520px;
  display:none;
  pointer-events:none;
  filter: drop-shadow(0 14px 18px rgba(0,0,0,.25));
}
.celebration.show{display:block;}

.ninja,.bijan{
  position:absolute;
  right:10px;
  top:10px;
  display:none;
  pointer-events:none;
}
.ninja.show,.bijan.show{display:block;}
.ninja img{width:50px;}
.bijan img{width:78px;}

.result{display:none; font-family:"Fredoka", system-ui, sans-serif;}
.result.show{display:block;}
.photo img{width:min(360px,82vw); height:auto; display:block; margin: 0 auto;}
</style>
</head>

<body>

<div class="flowers" id="flowers"></div>

<div class="wrap">
  <div class="card">

    <div class="ninja" id="ninja"><img src="ninja.png" alt="ninja"></div>
    <div class="bijan" id="bijan"><img src="bijan.png" alt="bijan"></div>

    <div class="title" id="titleText">Will you be my valentine?</div>

    <div class="arena" id="arena">

      <img id="yesImg" class="yesImgBtn" src="yes.png" alt="yes">

      <div class="dogChaser" id="dogChaser" aria-hidden="true">
        <img src="caspy.png" alt="dog">
      </div>

      <img id="noImg" class="noImgBtn" src="no.png" alt="no">

      <img id="celebration" class="celebration" src="celebration.gif" alt="celebration">

    </div>

    <div class="result" id="result">
      <div style="font-weight:600; font-size:clamp(18px,4vw,22px); margin-top:12px;">
        Yayyyyy!!! love you my g ‚ù§Ô∏è
      </div>
      <div class="photo"><img src="me.jpg" alt="me"></div>
    </div>

  </div>
</div>

<audio id="barkSound" src="bark.wav" preload="auto"></audio>
<audio id="yesSound" src="yes.wav" preload="auto"></audio>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>

<script>
const yesImg = document.getElementById("yesImg");
const noImg = document.getElementById("noImg");
const dog = document.getElementById("dogChaser");
const arena = document.getElementById("arena");
const celebration = document.getElementById("celebration");
const result = document.getElementById("result");
const ninja = document.getElementById("ninja");
const bijan = document.getElementById("bijan");
const flowers = document.getElementById("flowers");
const barkSound = document.getElementById("barkSound");
const yesSound = document.getElementById("yesSound");
const titleText = document.getElementById("titleText");

let yesClicked = false;
let noAttemptedOnce = false;

function playBark(){
  try{ barkSound.currentTime=0; barkSound.play(); }catch(e){}
}
function playYes(){
  try{ yesSound.currentTime=0; yesSound.play(); }catch(e){}
}

function spawnLoveRain(){
  flowers.classList.add("show");
  const em=["üíñ","üåπ","üíï","‚ú®","üíò","üíù"];
  const t=setInterval(()=>{
    const d=document.createElement("div");
    d.className="flower";
    d.textContent=em[Math.floor(Math.random()*em.length)];
    d.style.left=Math.random()*100+"vw";
    d.style.animationDuration=(2.0 + Math.random()*1.8) + "s";
    d.style.fontSize=(22 + Math.random()*20) + "px";
    flowers.appendChild(d);
    setTimeout(()=>d.remove(),4200);
  },80);

  setTimeout(()=>{
    clearInterval(t);
    flowers.classList.remove("show");
  },2100);
}

function fireworks(){
  if (typeof confetti !== "function") return;
  confetti({ particleCount: 170, spread: 80, startVelocity: 42, origin:{x:.5,y:.55} });
  confetti({ particleCount: 70, spread: 60, startVelocity: 32, origin:{x:.5,y:.45}, shapes:["heart"] });
}

/* ‚úÖ Mobile fix: shrink YES/NO if they would overlap or spill out */
function fitChoiceImages(){
  if (yesClicked) return;

  const a = arena.getBoundingClientRect();
  const pad = 16;                // left padding already used by YES
  const gap = 12;                // minimum gap between yes and no
  const noLeftFrac = 0.50;        // NO starts at 50% like your original

  // Reset to base width before measuring/shrinking
  yesImg.style.width = "175px";
  noImg.style.width  = "175px";

  // If images not loaded yet, retry
  const yesW = yesImg.getBoundingClientRect().width;
  const noW  = noImg.getBoundingClientRect().width;
  if (!yesW || !noW) return;

  // Compute max width allowed so YES (at 16px) and NO (at 50%) don't overlap.
  // YES occupies: [16, 16 + w]
  // NO occupies:  [0.5*aW, 0.5*aW + w]
  const maxWFromOverlap = (noLeftFrac * a.width) - pad - gap;

  // Also ensure NO fully fits in arena right side
  const maxWFromRightEdge = a.width - (noLeftFrac * a.width) - pad;

  // Also ensure YES fully fits left side (it already does, but keep safe)
  const maxWFromLeft = a.width - 2*pad;

  const maxW = Math.floor(Math.max(110, Math.min(175, maxWFromOverlap, maxWFromRightEdge, maxWFromLeft)));

  yesImg.style.width = maxW + "px";
  noImg.style.width  = maxW + "px";
}

/* "No attempt" ninja + dog goes in front and sits on the NO button */
function onFirstNoAttempt(){
  if (noAttemptedOnce || yesClicked) return;
  noAttemptedOnce = true;
  ninja.classList.add("show");
  dog.classList.add("front");
  chaseDogToNo();
}

function chaseDogToNo(){
  if (yesClicked) return;
  const a = arena.getBoundingClientRect();
  const b = noImg.getBoundingClientRect();
  const cx = (b.left - a.left) + b.width/2;
  const cy = (b.top  - a.top ) + b.height/2;
  dog.style.left = cx + "px";
  dog.style.top  = cy + "px";
  dog.style.transform = "translate(-50%,-50%)";
}

function handleNoThreat(e){
  if (yesClicked) return;
  onFirstNoAttempt();
  playBark();
  chaseDogToNo();
  e.preventDefault?.();
}

noImg.addEventListener("mouseenter", handleNoThreat);
noImg.addEventListener("pointerdown", handleNoThreat);
noImg.addEventListener("touchstart", (e) => {
  const t = e.touches[0];
  handleNoThreat({ preventDefault: () => e.preventDefault() });
}, { passive:false });

function onYes(){
  if (yesClicked) return;
  yesClicked = true;

  playYes();

  // hide and remove title
  titleText.classList.add("hide");
  setTimeout(()=>{ titleText.remove(); }, 450);

  // remove choice images + dog
  yesImg.remove();
  noImg.remove();
  dog.remove();

  // show celebration + bijan + result
  celebration.classList.add("show");
  bijan.classList.add("show");
  result.classList.add("show");

  spawnLoveRain();
  fireworks();
}

yesImg.addEventListener("click", onYes);
yesImg.addEventListener("pointerdown", (e)=>{ e.preventDefault?.(); onYes(); });

/* run sizing after load and on resize */
window.addEventListener("load", () => {
  fitChoiceImages();
  // re-fit once images are definitely loaded
  setTimeout(fitChoiceImages, 60);
  setTimeout(fitChoiceImages, 200);
});

window.addEventListener("resize", () => {
  fitChoiceImages();
  // keep dog aligned over NO if it already started blocking
  if (noAttemptedOnce && !yesClicked) setTimeout(chaseDogToNo, 30);
});

// Also refit when each image loads (important on phones)
yesImg.addEventListener("load", fitChoiceImages);
noImg.addEventListener("load", fitChoiceImages);
</script>

</body>
</html>
